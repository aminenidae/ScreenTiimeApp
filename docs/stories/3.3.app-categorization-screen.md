# <!-- Powered by BMAD™ Core -->

# Story 3.3: App Categorization Screen Implementation

## Status
Approved

## Story
**As a** parent,
**I want** an easy-to-use app categorization screen,
**so that** I can quickly set up and adjust which apps are educational vs. reward.

## Acceptance Criteria
1. App categorization interface is organized and efficient
2. Search and filter capabilities help find specific apps
3. Bulk categorization options save time for parents
4. Changes are immediately reflected in the tracking system

## Tasks / Subtasks

- [x] Task 1: Implement App Categorization View (AC: 1, 2)
  - [x] Create AppCategorizationView with organized layout for app listing
  - [x] Implement search functionality to find specific apps
  - [x] Add filter capabilities (All, Learning, Reward apps)
  - [x] Create unit tests for categorization UI components

- [x] Task 2: Implement Bulk Categorization Features (AC: 3)
  - [x] Design and implement bulk selection interface
  - [x] Add bulk action buttons for mass categorization
  - [x] Implement confirmation dialog for bulk actions
  - [x] Create unit tests for bulk categorization components

- [x] Task 3: Implement Data Loading and Real-time Updates (AC: 4)
  - [x] Create AppCategorizationViewModel with app data loading
  - [x] Implement CloudKit subscriptions for real-time updates
  - [x] Add Combine publishers for reactive UI updates
  - [x] Create integration tests for data loading and updates

- [x] Task 4: Implement Search and Filter Functionality (AC: 2)
  - [x] Create search bar component with debounced input
  - [x] Implement filtering logic for app categories
  - [x] Add sorting options (alphabetical, recently used, etc.)
  - [x] Create unit tests for search and filter components

- [x] Task 5: Implement Navigation and Routing (AC: 1, 4)
  - [x] Connect categorization elements to appropriate views
  - [x] Implement navigation back to Parent Dashboard
  - [x] Add settings access from categorization screen
  - [x] Create integration tests for navigation flows

- [x] Task 6: Performance Optimization and Accessibility (AC: 1, 3)
  - [x] Optimize app list for smooth scrolling with many apps
  - [x] Implement proper accessibility labels and traits for parents
  - [x] Add performance monitoring for categorization loading
  - [x] Create UI tests for accessibility features

- [x] Task 7: Integration Testing and Validation (AC: 1, 2, 3, 4)
  - [x] Create end-to-end integration tests
  - [x] Validate UI with different app counts (10, 50, 100+ apps)
  - [x] Test real-time updates with CloudKit subscriptions
  - [x] Document test results

## Dev Notes

### Previous Story Insights
Key learnings from Story 3.2 (Child Dashboard UI Implementation):
- Successfully implemented ChildDashboardView with points display
- Created RewardRedemptionView for app selection
- Extended FamilyControlsService with reward time allocation
- Established patterns for CloudKit data synchronization
- Created comprehensive unit and integration testing approaches

Key learnings from Story 3.1 (Parent Dashboard UI Implementation):
- Successfully implemented ParentDashboardView with child progress cards
- Created progress rings for daily learning goals
- Implemented point accumulation charts for last 7 days
- Established patterns for CloudKit data synchronization
- Created comprehensive unit and integration testing approaches

Key learnings from Story 2.1 (App Categorization UI Implementation):
- Successfully implemented basic app categorization interface
- Created AppDiscoveryService for fetching installed apps
- Implemented AppCategorizationRepository for CloudKit storage
- Established patterns for app categorization and validation
- Created comprehensive unit and integration testing approaches

### Dependencies
- Epic 3 (User Experience & Interface)
- Story 2.1 (App Categorization UI Implementation)
- Story 3.1 (Parent Dashboard UI Implementation)

### Technology Stack Requirements [Source: docs/architecture/tech-stack.md]
- **Frontend Language:** Swift 5.9+
- **Frontend Framework:** SwiftUI (iOS 15.0+) - Declarative UI framework
- **State Management:** Combine + SwiftUI @Published - Native to SwiftUI, seamless integration with CloudKit publishers
- **Backend Framework:** CloudKit Framework (iOS 15.0+) - Serverless backend
- **Database:** CloudKit (Primary) + CoreData (Cache)
- **Screen Time Integration:** Family Controls Framework (iOS 15.0+) - Managed Settings Store for reward enforcement
- **Frontend Testing:** XCTest + SwiftUI Previews (Xcode 15.0+) - Unit and UI testing

### Project Structure and Architecture [Source: docs/architecture/source-tree.md]
```
ScreenTimeRewards/
├── ScreenTimeRewards/                      # Main iOS app
│   ├── App/
│   ├── Features/
│   │   ├── ParentDashboard/
│   │   ├── ChildDashboard/
│   │   ├── AppCategorization/              # TARGET: Enhanced feature directory for app categorization
│   │   ├── RewardRedemption/
│   │   └── Settings/
│   └── Resources/
├── Packages/                               # Local Swift packages
│   ├── RewardCore/                         # Business logic
│   ├── CloudKitService/
│   ├── FamilyControlsKit/
│   ├── SubscriptionService/
│   ├── DesignSystem/
│   ├── SharedModels/
│   └── AppIntents/
```

### Data Models [Source: docs/architecture/data-models.md]
- `AppCategorization` - Parent-defined classification of apps as learning or reward with point values
  - Fields: id, childProfileID, bundleIdentifier, appName, category, pointsPerHour, iconData, isActive
- `AppCategory` - Enum: `.learning` or `.reward`
- `AppMetadata` - App information including name, icon, and bundle identifier

### App Categorization Architecture [Source: docs/architecture/components.md]
- ParentDashboardFeature as central UI component for parent experience
- AppCategorizationViewModel for data loading and state management
- CloudKit subscriptions for real-time updates
- Repository pattern for data access
- Combine publishers for reactive UI updates

### UI Component Specifications
- **AppListView**: Scrollable list of installed apps with categorization controls
  - Size: Full screen width, variable height
  - Elements: App icon, app name, category selector, point value input
  - States: Learning (with point value), Reward, Uncategorized

- **SearchBarView**: Search component for filtering apps
  - Size: Full width, 44pt height
  - Elements: Search field, clear button
  - Features: Debounced search, placeholder text

- **FilterBarView**: Filter controls for app categories
  - Size: Full width, 44pt height
  - Elements: All, Learning, Reward buttons
  - States: Selected filter highlighted

- **BulkActionView**: Controls for selecting and categorizing multiple apps
  - Size: Full width, 50pt height
  - Elements: Select all/none checkbox, bulk action buttons
  - Actions: Bulk categorize as Learning/Reward

- **CategorySelectorView**: Component for selecting app category with point value input
  - Size: Variable based on content
  - Elements: Category picker, point value input (for Learning apps)
  - States: Learning (with point input), Reward

### File Locations and Naming
- App Categorization View: `ScreenTimeRewards/Features/AppCategorization/Views/AppCategorizationView.swift`
- App Categorization ViewModel: `ScreenTimeRewards/Features/AppCategorization/ViewModels/AppCategorizationViewModel.swift`
- App Categorization Models: `ScreenTimeRewards/Features/AppCategorization/Models/`
- UI Components: `ScreenTimeRewards/Features/AppCategorization/Views/Components/`
- Unit tests: `Tests/ScreenTimeRewardsTests/Features/AppCategorization/`
- Integration tests: `Tests/IntegrationTests/AppCategorizationTests/`

### Technical Constraints [Source: docs/architecture/tech-stack.md]
- **iOS Version:** 15.0+ required (Family Controls framework dependency)
- **Device Requirement:** Physical device required for Family Controls testing
- **Framework Dependency:** Native Family Controls framework only
- **Privacy Compliance:** COPPA regulations must be maintained
- **Performance:** Efficient UI with minimal battery impact

### Security and Privacy Considerations
- Family Controls requires proper parent authorization
- Secure storage of app categorization data in CloudKit private zones
- Respect privacy boundaries for app usage data
- Proper error handling for authorization failures

## Testing

### Test Location [Source: docs/architecture/testing-strategy.md]
- Unit tests in `Tests/ScreenTimeRewardsTests/Features/AppCategorization/` directory
- Integration tests in `Tests/IntegrationTests/AppCategorizationTests/` directory

### Testing Standards [Source: docs/architecture/testing-strategy.md]
- **Framework:** XCTest native framework
- **Pyramid:** 70% Unit, 20% Integration, 10% E2E
- **Naming:** Descriptive test method names
- **Coverage:** All public interfaces must have unit tests

### Specific Testing Requirements
- Test App Categorization View with various app counts (10, 50, 100+ apps)
- Verify real-time updates with CloudKit subscriptions
- Validate data loading and error handling
- Test search and filter functionality
- Verify bulk categorization operations
- Test navigation to other screens
- Physical device testing for Family Controls functionality
- Performance testing for UI responsiveness
- Accessibility testing for all UI elements (parent-friendly)

### Edge Case Testing Scenarios
- Large number of installed apps (100+ apps)
- Apps with long names that need truncation
- Network connectivity issues during categorization
- Concurrent categorization by multiple parents
- Invalid point values (negative, zero, extremely high)
- Apps that are removed/uninstalled during categorization
- Different screen sizes (iPhone SE to iPad Pro)

### Performance Benchmarks
- App list loading time: < 1 second (50 apps)
- Search filtering time: < 200ms
- Bulk categorization time: < 500ms (50 apps)
- CloudKit subscription update time: < 1 second
- Memory usage: < 75MB when categorization screen is active

### Accessibility Requirements
- All interactive elements have accessibility labels
- VoiceOver support for all categorization components
- Large touch targets (minimum 44pt x 44pt)
- High contrast mode support
- Dynamic text size support (Large Text accessibility setting)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-27 | 1.0 | Initial story creation | Bob (Scrum Master) |
| 2025-09-27 | 1.1 | Story validated and approved | Sarah (Product Owner) |
| 2025-09-27 | 1.2 | Implementation completed | James (Full Stack Developer) |
