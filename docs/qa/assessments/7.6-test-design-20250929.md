# Test Design: Story 7.6

Date: 2025-09-29
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 28
- Unit tests: 12 (43%)
- Integration tests: 10 (36%)
- UI tests: 6 (21%)
- Priority distribution: P0: 10, P1: 12, P2: 6

## Test Scenarios by Acceptance Criteria

### AC1: Feature Gate Service
**Description**: `FeatureGateService` singleton created, checks subscription status before feature access, returns `FeatureAccessResult` (allowed/denied/trial)

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 7.6-UNIT-001 | Unit | P0 | FeatureGateService singleton creation | Core service initialization |
| 7.6-UNIT-002 | Unit | P0 | Feature access result evaluation for active subscription | Core business logic |
| 7.6-UNIT-003 | Unit | P0 | Feature access result evaluation for trial users | Core business logic |
| 7.6-UNIT-004 | Unit | P0 | Feature access result evaluation for expired subscription | Core business logic |
| 7.6-INT-001 | Integration | P0 | FeatureGateService integration with EntitlementValidationService | Service interaction |
| 7.6-INT-002 | Integration | P1 | FeatureGateService caching behavior | Performance optimization |

### AC2: Feature Access Rules
**Description**: Trial users: Full access to all features, 1 Child Plan: 1 child profile, all features, 2+ Child Plans: Multiple children, all features, Expired subscription: Read-only access, paywall prompts

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 7.6-UNIT-005 | Unit | P0 | Trial user full access | Core business rule |
| 7.6-UNIT-006 | Unit | P0 | Child count limits based on subscription tier | Core business rule |
| 7.6-UNIT-007 | Unit | P0 | Expired subscription read-only access | Core business rule |
| 7.6-INT-003 | Integration | P1 | Subscription tier to feature mapping | Business rule validation |
| 7.6-INT-004 | Integration | P1 | Grace period access handling | Edge case validation |

### AC3: Gated Features
**Description**: Child profile creation (based on tier), Advanced analytics (premium only after trial), Export reports (premium only), Multi-parent invitations (v1.1, premium only)

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 7.6-UNIT-008 | Unit | P0 | Child profile creation gating | Core premium feature |
| 7.6-UNIT-009 | Unit | P0 | Advanced analytics access control | Core premium feature |
| 7.6-UNIT-010 | Unit | P0 | Export reports access control | Core premium feature |
| 7.6-UNIT-011 | Unit | P1 | Multi-parent invitation access control | Future premium feature |
| 7.6-INT-005 | Integration | P1 | Feature flag system | Configuration management |

### AC4: Paywall Trigger Points
**Description**: Add child beyond limit → Upgrade paywall, Access premium analytics → Subscribe paywall, Trial expiration → Conversion paywall, Lapsed subscription → Re-subscribe paywall

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 7.6-UNIT-012 | Unit | P0 | Child limit exceeded paywall trigger | Core paywall scenario |
| 7.6-INT-006 | Integration | P0 | Premium analytics access paywall | Core paywall scenario |
| 7.6-INT-007 | Integration | P0 | Trial expiration conversion paywall | Core paywall scenario |
| 7.6-INT-008 | Integration | P0 | Lapsed subscription re-subscribe paywall | Core paywall scenario |
| 7.6-INT-009 | Integration | P1 | Paywall navigation coordinator | UI flow validation |

### AC5: UI Feature Gating
**Description**: Premium features show "lock" badge when unavailable, Tap on locked feature opens paywall, Upgrade prompts display pricing and value prop

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 7.6-UI-001 | UI | P0 | Lock badge display for unavailable features | Core UI behavior |
| 7.6-UI-002 | UI | P0 | Tap on locked feature opens paywall | Core UI interaction |
| 7.6-UI-003 | UI | P1 | Upgrade prompt UI with pricing display | Core UI behavior |

### AC6: Graceful Degradation
**Description**: Expired users retain read-only access to existing data, No data deletion on subscription lapse, Core app categorization remains functional (view-only)

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 7.6-INT-010 | Integration | P0 | Read-only access for expired subscriptions | Core business rule |
| 7.6-INT-011 | Integration | P1 | No data deletion on subscription lapse | Data protection |
| 7.6-INT-012 | Integration | P1 | Core app categorization view-only access | Core business rule |

### AC7: Messaging & CTAs
**Description**: Clear upgrade benefits messaging, "Unlock with Premium" buttons, Trial countdown creates urgency

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 7.6-UI-004 | UI | P1 | Clear upgrade benefits messaging | UX requirement |
| 7.6-UI-005 | UI | P1 | "Unlock with Premium" button components | UX requirement |
| 7.6-UI-006 | UI | P2 | Trial countdown UI with urgency messaging | UX requirement |

## Risk Coverage

The test design covers all identified risks from the risk assessment:

1. **SEC-001 (Revenue Protection)**: Covered by P0 tests for all feature access controls and paywall triggers
2. **PERF-001 (Performance)**: Covered by caching behavior tests
3. **DATA-001 (Data Loss)**: Covered by graceful degradation tests
4. **TECH-001 (UI Consistency)**: Covered by UI tests for lock badges and paywall triggers
5. **TECH-002 (Child Count Validation)**: Covered by child profile creation gating tests
6. **TECH-003 (Cache Invalidation)**: Covered by caching behavior tests

## Recommended Execution Order

1. P0 Unit tests (fail fast)
2. P0 Integration tests
3. P0 UI tests
4. P1 tests in order
5. P2 tests as time permits

## Test Design Matrix

test_design:
  scenarios_total: 28
  by_level:
    unit: 12
    integration: 10
    ui: 6
  by_priority:
    p0: 10
    p1: 12
    p2: 6
  coverage_gaps: 
    - "Missing unit tests for existing FeatureGateService implementation"
    - "Missing unit tests for existing PaywallTriggerService implementation"
    - "Missing UI tests for feature gating components"